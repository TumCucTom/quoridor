<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quoridor - Local PvP</title>
    <link rel="stylesheet" href="qf_freeboard.css">
    <link rel="stylesheet" href="qf_style.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #faf8f3;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            color: #333;
            display: flex;
            flex-direction: column;
        }

        .container {
            background: transparent;
            width: 100%;
            height: 100vh;
            margin: 0;
            padding: 20px 40px;
            display: flex;
            flex-direction: column;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        .btn-toggle {
            background: #d78f69;
            color: white;
        }

        .btn-toggle:hover {
            background: #e19d78;
        }

        .btn-toggle.active {
            background: #d76969;
        }

        h1 {
            font-size: 1.8em;
            color: #333;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .game-controls {
            display: flex;
            gap: 10px;
        }

        .btn-primary, .btn-secondary {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 0.95em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: #7fa650;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .btn-primary:hover {
            background: #6d8f42;
            transform: translateY(-1px);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary:hover {
            background: #e5e5e5;
            transform: translateY(-1px);
        }

        .game-area {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 40px;
            margin-bottom: 20px;
            flex: 1;
            min-height: 0;
        }

        .freeboard-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
        }

        /* Hide control buttons and input field */
        .qf_controlpanel {
            display: none !important;
        }

        .qf_textfield {
            display: none !important;
        }

        /* Dark Mode */
        body.dark-mode {
            background: #1a1a1a;
            color: #e0e0e0;
        }

        body.dark-mode header {
            border-bottom-color: #444;
        }

        body.dark-mode h1 {
            color: #e0e0e0;
        }

        body.dark-mode .btn-secondary {
            background: #404040;
            color: #e0e0e0;
        }

        body.dark-mode .btn-secondary:hover {
            background: #505050;
        }

        body.dark-mode .btn-toggle {
            background: #d78f69;
        }

        body.dark-mode .btn-toggle:hover {
            background: #e19d78;
        }

        body.dark-mode .btn-toggle.active {
            background: #d76969;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Quoridor</h1>
            <div class="game-controls">
                <button id="autoFlipBtn" class="btn-secondary btn-toggle">Auto Flip Board</button>
                <button id="darkModeBtn" class="btn-secondary">Dark Mode</button>
                <button onclick="location.reload()" class="btn-primary">New Game</button>
            </div>
        </header>

        <div class="game-area">
            <div class="freeboard-wrapper">
                <div class="qf_freeboard" data-boardsize="10"></div>
            </div>
        </div>
    </div>

    <script src="jquery.min.js"></script>
    <script src="qf_freeboard.js"></script>
    <script>
        let autoFlipEnabled = false;
        let lastTurnNum = 1;
        let freeboardElement = null;

        // Dark mode toggle
        document.getElementById('darkModeBtn').addEventListener('click', function() {
            document.body.classList.toggle('dark-mode');
            this.textContent = document.body.classList.contains('dark-mode') ? 'Light Mode' : 'Dark Mode';
        });

        // Auto flip toggle
        document.getElementById('autoFlipBtn').addEventListener('click', function() {
            autoFlipEnabled = !autoFlipEnabled;
            this.classList.toggle('active', autoFlipEnabled);
            
            if (autoFlipEnabled && freeboardElement) {
                updateBoardFlip();
            }
        });

        function updateBoardFlip() {
            if (!autoFlipEnabled || !freeboardElement) return;
            
            const $board = $(freeboardElement);
            const turnNum = parseInt($board.find('.qf_info_turn_num').text(), 10) || 1;
            const isBlackTurn = (turnNum % 2 === 0); // Even turn numbers = black's turn
            
            if (isBlackTurn) {
                $board.find('.qf_gameboard').addClass('qf_boardInversed');
                $board.find('.qf_char').addClass('qf_boardInversed');
            } else {
                $board.find('.qf_gameboard').removeClass('qf_boardInversed');
                $board.find('.qf_char').removeClass('qf_boardInversed');
            }
        }

        // Monitor turn changes
        function watchTurnChanges() {
            const observer = new MutationObserver(function(mutations) {
                if (!autoFlipEnabled) return;
                
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList' || mutation.type === 'characterData') {
                        const newTurnNum = parseInt($(freeboardElement).find('.qf_info_turn_num').text(), 10) || 1;
                        if (newTurnNum !== lastTurnNum) {
                            lastTurnNum = newTurnNum;
                            updateBoardFlip();
                        }
                    }
                });
            });

            // Wait for freeboard to initialize
            setTimeout(function() {
                freeboardElement = document.querySelector('.qf_freeboard');
                if (freeboardElement) {
                    const turnNumElement = $(freeboardElement).find('.qf_info_turn_num')[0];
                    if (turnNumElement) {
                        observer.observe(turnNumElement, {
                            childList: true,
                            characterData: true,
                            subtree: true
                        });
                        lastTurnNum = parseInt(turnNumElement.textContent, 10) || 1;
                    }
                }
            }, 500);
        }

        // Start watching when page loads
        watchTurnChanges();
    </script>
</body>
</html>
